{
  "project": "2000nl",
  "branchName": "ralph/learning-ux-testing-tools",
  "description": "Learning UX & Testing Tools Sprint - First-time card learning experience, URL testing parameters, and SRS debugging tools",
  "userStories": [
    {
      "id": "US-029",
      "title": "SRS History Analysis Script",
      "description": "Create a database query script to analyze user learning history, tracking how words were shown, intervals changed, and user responses to debug SRS queue issues like words repeating despite 'goed' answers. Similar to existing /home/khrustal/dev/2000nl-ui/db/scripts/psql_supabase.sh but tailored for debugging SRS behavior.",
      "acceptanceCriteria": [
        "Script accepts user ID as parameter",
        "Optionally filter by word/card ID",
        "Shows chronological history of card appearances",
        "Includes interval values before/after each review",
        "Includes user response for each review (again/hard/good/easy)",
        "Can identify anomalies (same card shown repeatedly despite good answer)",
        "Script tested with sample user data",
        "Typecheck passes"
      ],
      "priority": 1,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-027.1",
      "title": "URL Parameter Parsing for Card Access",
      "description": "Create URL parameter parsing infrastructure to support direct card loading and layout control for testing purposes. Create reusable hook for param extraction using Next.js useSearchParams.",
      "acceptanceCriteria": [
        "Create useCardParams hook in lib/cardParams.ts",
        "Parse wordId parameter from URL (supports word ID or word text)",
        "Parse layout parameter from URL (w2d or d2w)",
        "Parse devMode flag from URL",
        "Hook returns typed object with parsed values",
        "Unit tests for parameter parsing",
        "Typecheck passes"
      ],
      "priority": 2,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-027.2",
      "title": "Implement Word Loading from URL",
      "description": "Enable loading a specific word directly when URL parameters are present, bypassing normal queue logic. Leverages existing forcedNextWordIdRef mechanism in TrainingScreen.",
      "acceptanceCriteria": [
        "Read wordId from useCardParams() in TrainingScreen",
        "When wordId present, set forcedNextWordIdRef.current",
        "Word loads immediately on page load",
        "Falls back to normal queue when no URL param",
        "Works with both word IDs and word text",
        "Typecheck passes",
        "Verify in browser using Chrome DevTools MCP: load /?wordId=fiets shows fiets card"
      ],
      "priority": 3,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-027.3",
      "title": "Add Dev Mode Gating",
      "description": "Gate the URL parameter features behind dev mode to prevent regular users from discovering/using this testing functionality. Check environment or URL param.",
      "acceptanceCriteria": [
        "URL params only respected when devMode=true in URL OR environment variable set",
        "Production users cannot access this feature",
        "Dev console message when dev mode active (optional but helpful)",
        "Typecheck passes",
        "Verify in browser using Chrome DevTools MCP: params ignored without devMode flag"
      ],
      "priority": 4,
      "passes": true,
      "notes": ""
    },
    {
      "id": "US-030.1",
      "title": "Add First Encounter Detection",
      "description": "Add logic to detect when a word is being shown to the user for the very first time, before any learning has started. Backend already returns source='new' for unseen words.",
      "acceptanceCriteria": [
        "Add isFirstEncounter: boolean field to TrainingWord type in types.ts",
        "Populate isFirstEncounter based on source === 'new' in trainingService",
        "Field available in TrainingScreen and TrainingCard components",
        "Console log verification: new words show isFirstEncounter: true",
        "Typecheck passes"
      ],
      "priority": 5,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-030.5",
      "title": "Force W→D Direction for First-Time Cards",
      "description": "Ensure first-time cards always show word-to-definition direction (W→D) so it's clear which word the user is trying to learn. Current behavior has RPC choose direction randomly.",
      "acceptanceCriteria": [
        "When isFirstEncounter === true, force card layout to W→D mode",
        "Override any backend-selected layout for first encounter",
        "Subsequent reviews can use any layout (determined by scenario/RPC)",
        "Typecheck passes",
        "Verify in browser using Chrome DevTools MCP: first-time cards always show Dutch word first"
      ],
      "priority": 6,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-030.2",
      "title": "Create FirstTimeButtonGroup Component",
      "description": "Create a new button component that shows two options for first-time words: 'Start learning' and 'I know it already', replacing the standard 4-button interface for first encounters.",
      "acceptanceCriteria": [
        "Create FirstTimeButtonGroup.tsx component in apps/ui/components/training/",
        "Shows two buttons: 'Start learning' (Dutch: 'Begin met leren') and 'I know it already' (Dutch: 'Ik ken dit al')",
        "Component accepts onStartLearning and onAlreadyKnow callbacks",
        "Styled consistently with existing button design from ActionButtons",
        "Conditionally render in TrainingCard based on isFirstEncounter",
        "Standard 4-button group hidden when first-time buttons shown",
        "Typecheck passes",
        "Verify in browser using Chrome DevTools MCP"
      ],
      "priority": 7,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-030.3",
      "title": "Wire Start Learning Button",
      "description": "Connect the 'Start learning' button to the existing action handler so it behaves like 'opniew' (again), adding the word to the learning queue with initial interval.",
      "acceptanceCriteria": [
        "'Start learning' button calls handleAction('fail') or equivalent",
        "Word is added to learning queue with initial interval",
        "Subsequent cards for this word show standard 4-button interface",
        "State transitions correctly from first-time to learning",
        "Typecheck passes",
        "Verify in browser using Chrome DevTools MCP: click 'Start learning', word appears again in queue"
      ],
      "priority": 8,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-030.4",
      "title": "Wire I Know It Already Button",
      "description": "Connect the 'I know it already' button to mark the word as known and exclude it from the learning queue. Word should be hidden/frozen and not shown again.",
      "acceptanceCriteria": [
        "'I know it already' button calls action to hide/exclude word",
        "Word marked with hidden=true or equivalent flag in database",
        "Word does not appear in future training queues",
        "User can see word in 'known words' list (if such list exists, or note for future)",
        "Typecheck passes",
        "Verify in browser using Chrome DevTools MCP: click 'I know it already', word disappears from queue"
      ],
      "priority": 9,
      "passes": false,
      "notes": ""
    }
  ],
  "technicalNotes": {
    "codebasePath": "/home/khrustal/dev/2000nl-ui/",
    "componentsPath": "apps/ui/components/training/",
    "typesPath": "apps/ui/lib/types.ts",
    "servicePath": "apps/ui/lib/trainingService.ts",
    "patterns": [
      "Use Tooltip component from apps/ui/components/Tooltip.tsx for styled hover popups",
      "Type checking: npx tsc --noEmit from apps/ui/ directory",
      "Testing: npx vitest run from apps/ui/ directory"
    ],
    "database": {
      "table": "user_word_status",
      "fsrsFields": ["stability", "difficulty", "last_interval"],
      "sourceField": "source (new/review/practice)",
      "hiddenField": "Consider hidden field for I know it already functionality"
    },
    "testingSynergy": "URL parameters (US-027) enable easier testing of first-time buttons (US-030). Load /?wordId=test-word&devMode=true to verify first-time button UI."
  },
  "totalStoryPoints": 16,
  "nonGoals": [
    "No changes to SRS algorithm (FSRS)",
    "No mobile-specific layouts in this iteration",
    "Template switcher UI deferred to Phase 2",
    "Keyboard navigation deferred pending clarification",
    "Known words management UI is future enhancement"
  ]
}
