{
  "project": "2000nl",
  "branchName": "ralph/translation-system-refactoring",
  "description": "Translation System Refactoring - Fix translation overlay anchoring and wrapping based on US-EXPLORE findings. Refactor from absolute positioning to flow layout.",
  "userStories": [
    {
      "id": "US-034",
      "title": "Translation Overlay Anchoring",
      "description": "Refactor translation overlay positioning so translations are visually anchored to their original sentence, not floating or appearing attached to the wrong line. Currently uses absolute positioning tied to container bounds instead of text lines, causing visual confusion.",
      "acceptanceCriteria": [
        "Translations positioned directly below their original sentence",
        "Spacing to translation is smaller than spacing between sentences",
        "No visual collisions or overlaps",
        "Layout expands vertically when translation enabled",
        "Works on both mobile and desktop",
        "Works with both short and long sentences",
        "All existing translation features still work (toggle, language selection)",
        "Screenshots show before/after comparison with clear visual grouping",
        "Test with single-line and multi-line definitions",
        "Test with multiple translations visible at once",
        "Typecheck passes (npx tsc --noEmit from apps/ui/ directory)",
        "Verify in browser using Chrome DevTools MCP"
      ],
      "priority": 1,
      "passes": true,
      "notes": "",
      "technicalContext": {
        "complexity": "Medium/High",
        "explorationFindings": "From US-EXPLORE (2026-01-16): InlineTranslation uses absolute positioning (bottom-full) tied to container bounds, not text line. Multi-line definitions show overlay detached from intended line.",
        "rootCause": "absolute positioning with bottom-full inside relative wrappers",
        "recommendedApproach": "Flow Layout - Remove absolute positioning from InlineTranslation, wrap each sentence+translation pair in container, use normal flow layout with margin/padding for spacing",
        "files": [
          "apps/ui/components/training/TrainingCard.tsx"
        ],
        "mayCreateComponent": "TranslatedSentence.tsx for wrapping pattern",
        "implementationSteps": [
          "Refactor InlineTranslation to use relative/flow positioning instead of absolute",
          "Wrap each sentence+translation pair in a container div",
          "Use flexbox or grid to control spacing between sentences",
          "Ensure translation sits directly below its source line with smaller gap",
          "Add larger gap between sentence groups"
        ],
        "mustCompleteBefore": "US-036",
        "visualReference": [
          "assets/screenshots/2000NL-034-036-translation-overlay-annotated.png (before)",
          "assets/screenshots/2000NL-034-036-translation-system-annotated.png (architecture)"
        ],
        "explorationReference": "ralph/progress.txt (2026-01-16 US-EXPLORE section)"
      }
    },
    {
      "id": "US-036",
      "title": "Translation Text Wrapping and Clipping",
      "description": "Fix long translations being cut off instead of wrapping. After US-034 establishes proper flow layout, enable translations to wrap to multiple lines and take as much vertical space as needed. Critical for long sentences where translation is needed most.",
      "acceptanceCriteria": [
        "Long translations wrap to multiple lines (no clipping)",
        "Translation takes full vertical space needed",
        "Original sentence positioned correctly relative to translation",
        "No text overflow or fade effects",
        "Proper spacing maintained between translation and surrounding content",
        "Works on mobile and desktop",
        "Test with translations of varying lengths (short: 10 chars, medium: 30 chars, long: 80+ chars)",
        "Screenshots show before/after with long translations",
        "Mobile viewport shows proper wrapping without horizontal scroll",
        "Typecheck passes (npx tsc --noEmit from apps/ui/ directory)",
        "Verify in browser using Chrome DevTools MCP"
      ],
      "priority": 2,
      "passes": true,
      "notes": "",
      "technicalContext": {
        "complexity": "Medium",
        "explorationFindings": "From US-EXPLORE (2026-01-16): Overlay text forced to single line with truncate class. Long translations ellipsize instead of wrapping. No layout space reserved (absolute positioned).",
        "rootCause": "truncate class forces single line, overflow:hidden constraints",
        "dependsOn": "US-034",
        "criticalDependency": "CANNOT START until US-034 completes - anchoring establishes flow layout foundation",
        "files": [
          "apps/ui/components/training/TrainingCard.tsx"
        ],
        "implementationSteps": [
          "Remove truncate class from translation text",
          "Remove any overflow: hidden, text-overflow: ellipsis, or fixed height constraints",
          "Set white-space: normal and word-wrap: break-word on translation text",
          "Ensure sentence+translation container expands to fit content",
          "Test with very long translations (50+ characters)"
        ],
        "testingFocus": "Mobile viewport especially (narrower width = more wrapping). Test edge cases: very long words, multiple long translations.",
        "visualReference": [
          "assets/screenshots/2000NL-034-036-translation-overlay-annotated.png (shows truncation)"
        ]
      }
    }
  ]
}
