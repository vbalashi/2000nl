services:
  ui:
    build:
      context: ./apps/ui
      dockerfile: Dockerfile
      args:
        NEXT_PUBLIC_SUPABASE_URL: ${NEXT_PUBLIC_SUPABASE_URL}
        NEXT_PUBLIC_SUPABASE_ANON_KEY: ${NEXT_PUBLIC_SUPABASE_ANON_KEY}
        # Provided by CI/CD (see .github/workflows/deploy-nuc.yml). Optional for local dev.
        NEXT_PUBLIC_APP_COMMIT: ${NEXT_PUBLIC_APP_COMMIT:-}
        NEXT_PUBLIC_BUILD_TIMESTAMP: ${NEXT_PUBLIC_BUILD_TIMESTAMP:-}
        NEXT_PUBLIC_APP_VERSION: ${NEXT_PUBLIC_APP_VERSION:-}
    # IMPORTANT:
    # Next.js inlines NEXT_PUBLIC_* at build time, but server routes (e.g. /api/translation)
    # still require runtime secrets (Supabase service key, DeepL API key, etc.).
    #
    # On `nuc` we keep these values in `/srv/2000nl-ui/.env` (see saved_notes/deploy_on_nuc_guide.md).
    env_file:
      - .env
    restart: unless-stopped
    expose:
      - "3000"
    volumes:
      - /srv/2000nl-ui/db/audio:/db/audio
    networks:
      - nuc_default

networks:
  nuc_default:
    external: true
